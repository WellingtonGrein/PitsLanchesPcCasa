<title>
    @ViewData["Title"] - Gráfico de Vendas Semanal
</title>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<div class="admin-page-header">
    <h1>Vendas Semanais (7 Dias)</h1>
</div>

<div class="admin-content-card">
    <div id="chart_div" style="width: 100%; height: 600px;">
        <div class="d-flex justify-content-center align-items-center h-100 text-muted">
            <div class="spinner-border text-primary me-2" role="status"></div>
            <span>Carregando dados...</span>
        </div>
    </div>
</div>

<script type="text/javascript">
    google.charts.load('current', { packages: ['corechart', 'bar'] });
    google.charts.setOnLoadCallback(CarregaDados);

    var jsonDados;

    function CarregaDados() {
        $.ajax({
            url: '@Url.Action("VendasLanches", "AdminGrafico")',
            data: { dias: 7 },
            dataType: "json",
            type: "GET",
            error: function (xhr, status, error) {
                var err = eval("(" + xhr.responseText + ")");
                toastr.error(err.message);
            },
            success: function (data) {
                jsonDados = data;
                GraficoVendasLanches(jsonDados);
            }
        });
    }

    function GraficoVendasLanches(data) {
        var dataArray = [
            ['Lanche', 'Quantidade', 'Valor Total (R$)']
        ];

        $.each(data, function (i, item) {
            dataArray.push([item.lancheNome, item.lanchesQuantidade, item.lanchesValorTotal]);
        });

        var dataTable = google.visualization.arrayToDataTable(dataArray);

        var options = {
            title: 'Desempenho de Vendas - Últimos 7 Dias',
            titleTextStyle: {
                color: '#343a40',
                fontSize: 20,
                bold: true,
                fontName: 'Segoe UI'
            },
            fontName: 'Segoe UI',
            backgroundColor: 'transparent',
            curveType: 'function',
            lineWidth: 3,
            pointSize: 5,
            animation: {
                duration: 1000,
                easing: 'out',
                startup: true
            },
            chartArea: {
                width: '75%',
                height: '75%',
                top: 80
            },
            colors: ['#0d6efd', '#198754'],
            hAxis: {
                title: 'Lanches',
                textStyle: { color: '#6c757d' },
                titleTextStyle: { color: '#6c757d', italic: false }
            },
            vAxis: {
                title: 'Valores',
                textStyle: { color: '#6c757d' },
                titleTextStyle: { color: '#6c757d', italic: false },
                minValue: 0
            },
            legend: { position: 'top', alignment: 'center', textStyle: { fontSize: 14 } },
            tooltip: { isHtml: true, showColorCode: true }
        };

        var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
        chart.draw(dataTable, options);
    }

    $(window).resize(function () {
        if (jsonDados) {
            GraficoVendasLanches(jsonDados);
        }
    });
</script>