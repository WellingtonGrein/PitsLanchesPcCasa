<title>
    @ViewData["Title"] - Gráfico de Vendas
</title>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<div class="admin-page-header">
    <h1>Vendas Anuais (360 Dias)</h1>
</div>

<div class="admin-content-card">
    <div id="chart_div" style="width: 100%; height: 600px;">
        <div class="d-flex justify-content-center align-items-center h-100 text-muted">
            <div class="spinner-border text-primary me-2" role="status"></div>
            <span>Carregando dados do gráfico...</span>
        </div>
    </div>
</div>

<script type="text/javascript">
    google.charts.load('current', {packages: ['corechart', 'bar']});
    google.charts.setOnLoadCallback(CarregaDados);
    var jsonDados;

    function CarregaDados() {
        $.ajax({
            url: '@Url.Action("VendasLanches", "AdminGrafico")',
            data: {dias: 360},
            dataType: "json",
            type: "GET",
            error: function(xhr, status, error) {
                var err = eval("(" + xhr.responseText + ")");
                toastr.error(err.message);
            },
            success: function(data) {
                jsonDados = data;
                GraficoVendasLanches(jsonDados);
            }
        });
    }

    function GraficoVendasLanches(data) {
        var dataArray = [
            ['Lanche', 'Quantidade Vendida', 'Valor Total (R$)']
        ];

        $.each(data, function(i, item) {
            dataArray.push([item.lancheNome, item.lanchesQuantidade, item.lanchesValorTotal]);
        });

        var dataTable = google.visualization.arrayToDataTable(dataArray);

        var options = {
            title: 'Desempenho de Vendas por Lanche',
            titleTextStyle: {
                color: '#343a40',
                fontSize: 20,
                bold: true,
                fontName: 'Segoe UI'
            },
            fontName: 'Segoe UI',
            backgroundColor: 'transparent',
            chartArea: {
                width: '75%',
                height: '80%',
                left: 150 
            },
            colors: ['#0d6efd', '#198754'],
            hAxis: {
                title: 'Valores',
                minValue: 0,
                textStyle: { color: '#6c757d' },
                titleTextStyle: { color: '#6c757d', italic: false }
            },
            vAxis: {
                textStyle: { color: '#495057', fontSize: 13 }
            },
            legend: { position: 'top', alignment: 'center', textStyle: { fontSize: 14 } },
            animation: {
                startup: true,
                duration: 1000,
                easing: 'out',
            },
            tooltip: {
                isHtml: true,
                showColorCode: true,
                textStyle: { fontSize: 14 }
            }
        };

        var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
        chart.draw(dataTable, options);
    }

    $(window).resize(function(){
        if(jsonDados) {
            GraficoVendasLanches(jsonDados);
        }
    });
</script>